---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { getLatestPosts, getClusterStats } from '../lib/supabase';
import { generateWebSiteSchema, generateOrganizationSchema } from '../lib/seo';
import { getAllClusters, getCluster } from '../lib/clusters';
import { formatDate, truncate } from '../lib/text';

const posts = await getLatestPosts(30);
const clusterStats = await getClusterStats();
const clusters = getAllClusters();
const MAIN_SITE = 'https://www.vistaceo.com';

const schemas = [
  generateWebSiteSchema(),
  generateOrganizationSchema()
];

// Group posts by cluster (using category field from 12-cluster system)
const postsByCluster = clusters.reduce((acc, cluster) => {
  acc[cluster.slug] = posts.filter(p => p.category === cluster.slug).slice(0, 4);
  return acc;
}, {} as Record<string, typeof posts>);

// Get clusters with posts for display
const clustersWithPosts = clusters.filter(c => postsByCluster[c.slug]?.length > 0).slice(0, 4);
---

<BaseLayout 
  title="VistaCEO Blog | Insights para Escalar tu Negocio en LATAM"
  description="Tu CEO inteligente que diagnostica tu empresa y te ayuda a crecer con resultados reales. Gu√≠as pr√°cticas, estrategias probadas y las √∫ltimas tendencias de IA para PyMEs latinoamericanas."
  canonical="https://blog.vistaceo.com"
  schemas={schemas}
>
  <Header />
  
  <main class="main-content">
    <!-- Hero Section -->
    <section class="hero">
      <div class="hero-glow"></div>
      <div class="hero-content">
        <h1>
          Tu CEO Ultra Inteligente para <span class="text-gradient">Escalar tu Negocio</span>
        </h1>
        <p class="hero-subtitle">
          Inteligencia artificial que analiza tu negocio, detecta oportunidades y te gu√≠a con acciones concretas cada d√≠a para obtener resultados incre√≠bles.
        </p>
        <div class="hero-actions">
          <a href={`${MAIN_SITE}/auth`} class="btn-primary">
            Empezar gratis
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M5 12h14M12 5l7 7-7 7"/>
            </svg>
          </a>
          <a href="#explorar" class="btn-secondary">
            Explorar temas
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M6 9l6 6 6-6"/>
            </svg>
          </a>
        </div>
        <div class="hero-stats">
          <div class="stat">
            <span class="stat-number">{posts.length}+</span>
            <span class="stat-label">Art√≠culos</span>
          </div>
          <div class="stat-divider"></div>
          <div class="stat">
            <span class="stat-number">180+</span>
            <span class="stat-label">Tipos de Negocio</span>
          </div>
          <div class="stat-divider"></div>
          <div class="stat">
            <span class="stat-number">10</span>
            <span class="stat-label">Sectores</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Business Types Banner -->
    <section class="business-banner">
      <div class="banner-container">
        <p class="banner-intro">
          VistaCEO est√° dise√±ado para potenciar cualquier negocio con operaciones en LATAM, sin importar su tama√±o o sector:
        </p>
        <div class="sectors-grid">
          <div class="sector-card">
            <span class="sector-emoji">üçΩÔ∏è</span>
            <span class="sector-name">Gastronom√≠a</span>
            <span class="sector-examples">Restaurantes, cafeter√≠as, bares, food trucks...</span>
          </div>
          <div class="sector-card">
            <span class="sector-emoji">üõçÔ∏è</span>
            <span class="sector-name">Retail</span>
            <span class="sector-examples">Tiendas, farmacias, joyer√≠as, e-commerce...</span>
          </div>
          <div class="sector-card">
            <span class="sector-emoji">üíÜ</span>
            <span class="sector-name">Salud & Bienestar</span>
            <span class="sector-examples">Cl√≠nicas, spas, gimnasios, consultorios...</span>
          </div>
          <div class="sector-card">
            <span class="sector-emoji">üè®</span>
            <span class="sector-name">Turismo</span>
            <span class="sector-examples">Hoteles, agencias, tours, hostels...</span>
          </div>
          <div class="sector-card">
            <span class="sector-emoji">üíº</span>
            <span class="sector-name">Servicios Profesionales</span>
            <span class="sector-examples">Consultor√≠as, estudios, agencias...</span>
          </div>
          <div class="sector-card">
            <span class="sector-emoji">üìö</span>
            <span class="sector-name">Educaci√≥n</span>
            <span class="sector-examples">Academias, institutos, e-learning...</span>
          </div>
          <div class="sector-card">
            <span class="sector-emoji">üè†</span>
            <span class="sector-name">Hogar & Construcci√≥n</span>
            <span class="sector-examples">Inmobiliarias, muebler√≠as, arquitectura...</span>
          </div>
          <div class="sector-card">
            <span class="sector-emoji">üöö</span>
            <span class="sector-name">Log√≠stica</span>
            <span class="sector-examples">Transporte, mensajer√≠a, mudanzas...</span>
          </div>
          <div class="sector-card">
            <span class="sector-emoji">üåæ</span>
            <span class="sector-name">Agro & Industria</span>
            <span class="sector-examples">Productores, bodegas, exportadores...</span>
          </div>
          <div class="sector-card">
            <span class="sector-emoji">üíª</span>
            <span class="sector-name">Tecnolog√≠a</span>
            <span class="sector-examples">SaaS, startups, agencias digitales...</span>
          </div>
        </div>
      </div>
    </section>
    
    <div class="container">
      <!-- Latest Posts -->
      <section class="section">
        <div class="section-header">
          <h2 class="section-title">
            <span class="section-icon">üì∞</span>
            √öltimos Art√≠culos
          </h2>
        </div>
        <div class="posts-grid featured-grid">
          {posts.slice(0, 6).map((post, index) => {
            const cluster = getCluster(post.category);
            const isFeatured = index === 0;
            return (
              <a href={`/${post.slug}`} class={`post-card ${isFeatured ? 'featured' : ''}`}>
                {post.hero_image_url && (
                  <div class="post-image">
                    <img 
                      src={post.hero_image_url} 
                      alt={post.image_alt_text || post.title}
                      loading={index < 3 ? 'eager' : 'lazy'}
                      width="400"
                      height="225"
                    />
                  </div>
                )}
                <div class="post-content">
                  {cluster && (
                    <span class="post-cluster">
                      <span>{cluster.emoji}</span>
                      {cluster.name}
                    </span>
                  )}
                  <h3 class="post-title">{post.title}</h3>
                  {post.excerpt && (
                    <p class="post-excerpt">{truncate(post.excerpt, isFeatured ? 150 : 100)}</p>
                  )}
                  <div class="post-meta">
                    <span class="post-date">{formatDate(post.publish_at)}</span>
                    {post.reading_time_min && (
                      <span class="post-reading">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <circle cx="12" cy="12" r="10"/>
                          <polyline points="12 6 12 12 16 14"/>
                        </svg>
                        {post.reading_time_min} min
                      </span>
                    )}
                  </div>
                </div>
              </a>
            );
          })}
        </div>
      </section>
      
      <!-- Explore by Topic -->
      <section class="section" id="explorar">
        <div class="section-header">
          <h2 class="section-title">
            <span class="section-icon">üóÇÔ∏è</span>
            Explorar por Tema
          </h2>
          <p class="section-subtitle">
            12 categor√≠as especializadas para PyMEs latinoamericanas
          </p>
        </div>
        <div class="clusters-grid">
          {clusters.map((cluster) => {
            const postCount = clusterStats[cluster.slug] || 0;
            return (
              <a href={`/tema/${cluster.slug}`} class="cluster-card">
                <span class="cluster-emoji">{cluster.emoji}</span>
                <span class="cluster-name">{cluster.name}</span>
                <span class="cluster-count">{postCount} art√≠culos</span>
              </a>
            );
          })}
        </div>
      </section>
      
      <!-- Cluster Sections -->
      {clustersWithPosts.map((cluster) => {
        const clusterPosts = postsByCluster[cluster.slug];
        return (
          <section class="section">
            <div class="section-header">
              <h2 class="section-title">
                <span class="section-icon">{cluster.emoji}</span>
                {cluster.name}
              </h2>
              <a href={`/tema/${cluster.slug}`} class="section-link">
                Ver todos ‚Üí
              </a>
            </div>
            <div class="posts-grid">
              {clusterPosts.map((post) => (
                <a href={`/${post.slug}`} class="post-card">
                  {post.hero_image_url && (
                    <div class="post-image">
                      <img 
                        src={post.hero_image_url} 
                        alt={post.image_alt_text || post.title}
                        loading="lazy"
                        width="400"
                        height="225"
                      />
                    </div>
                  )}
                  <div class="post-content">
                    <h3 class="post-title">{post.title}</h3>
                    {post.excerpt && (
                      <p class="post-excerpt">{truncate(post.excerpt, 100)}</p>
                    )}
                    <span class="post-date">{formatDate(post.publish_at)}</span>
                  </div>
                </a>
              ))}
            </div>
          </section>
        );
      })}
      
      <!-- CTA Section -->
      <section class="cta-section">
        <div class="cta-card">
          <div class="cta-icon">üöÄ</div>
          <h2>¬øListo para escalar tu negocio?</h2>
          <p>
            VistaCEO es tu CEO ultra inteligente que diagnostica tu empresa, detecta oportunidades 
            y te gu√≠a con acciones concretas para crecer con resultados reales. 
            Adaptado a m√°s de 180 tipos de negocio en 10 sectores.
          </p>
          <a href={`${MAIN_SITE}/auth`} class="btn-primary">
            Empezar gratis
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M5 12h14M12 5l7 7-7 7"/>
            </svg>
          </a>
        </div>
      </section>
    </div>
  </main>
  
  <Footer />
</BaseLayout>

<style>
  .main-content {
    padding-top: 64px;
  }
  
  @media (min-width: 768px) {
    .main-content {
      padding-top: 72px;
    }
  }
  
  /* Hero */
  .hero {
    position: relative;
    padding: 4rem 1.5rem 3rem;
    text-align: center;
    overflow: hidden;
    background: var(--gradient-hero);
  }
  
  @media (min-width: 768px) {
    .hero {
      padding: 5rem 1.5rem 4rem;
    }
  }
  
  .hero-glow {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100%;
    max-width: 800px;
    height: 400px;
    background: var(--gradient-glow);
    filter: blur(80px);
    opacity: 0.5;
    pointer-events: none;
  }
  
  .hero-content {
    position: relative;
    max-width: 800px;
    margin: 0 auto;
    z-index: 1;
  }
  
  .hero h1 {
    font-size: 2rem;
    font-weight: 800;
    line-height: 1.15;
    margin-bottom: 1rem;
  }
  
  @media (min-width: 640px) {
    .hero h1 {
      font-size: 2.5rem;
    }
  }
  
  @media (min-width: 768px) {
    .hero h1 {
      font-size: 3rem;
    }
  }
  
  .hero-subtitle {
    font-size: 1rem;
    color: var(--foreground-muted);
    max-width: 600px;
    margin: 0 auto 1.5rem;
    line-height: 1.6;
  }
  
  @media (min-width: 640px) {
    .hero-subtitle {
      font-size: 1.125rem;
    }
  }
  
  .hero-actions {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 2rem;
  }
  
  @media (min-width: 480px) {
    .hero-actions {
      flex-direction: row;
      justify-content: center;
    }
  }
  
  .btn-primary {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: linear-gradient(135deg, #2692DC, #746CE6);
    color: white;
    font-size: 0.9375rem;
    font-weight: 600;
    text-decoration: none;
    border-radius: 0.75rem;
    box-shadow: 0 4px 20px rgba(38, 146, 220, 0.25);
    transition: all 0.2s;
  }
  
  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 28px rgba(38, 146, 220, 0.35);
    color: white;
  }
  
  .btn-secondary {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: var(--card);
    color: var(--foreground);
    font-size: 0.9375rem;
    font-weight: 600;
    text-decoration: none;
    border: 1px solid var(--border);
    border-radius: 0.75rem;
    transition: all 0.2s;
  }
  
  .btn-secondary:hover {
    background: var(--muted);
    border-color: var(--primary);
    color: var(--primary);
  }
  
  .hero-stats {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1.25rem;
  }
  
  .stat {
    text-align: center;
  }
  
  .stat-number {
    display: block;
    font-size: 1.25rem;
    font-weight: 700;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  @media (min-width: 640px) {
    .stat-number {
      font-size: 1.5rem;
    }
  }
  
  .stat-label {
    font-size: 0.75rem;
    color: var(--foreground-muted);
  }
  
  .stat-divider {
    width: 1px;
    height: 32px;
    background: var(--border);
  }

  /* Business Banner */
  .business-banner {
    background: var(--muted);
    padding: 2rem 1.5rem;
    border-top: 1px solid var(--border);
    border-bottom: 1px solid var(--border);
  }

  .banner-container {
    max-width: 1280px;
    margin: 0 auto;
  }

  .banner-intro {
    text-align: center;
    font-size: 0.9375rem;
    color: var(--foreground-muted);
    margin-bottom: 1.5rem;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
  }

  .sectors-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem;
  }

  @media (min-width: 640px) {
    .sectors-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (min-width: 768px) {
    .sectors-grid {
      grid-template-columns: repeat(5, 1fr);
    }
  }

  .sector-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding: 1rem 0.5rem;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 0.75rem;
    transition: all 0.2s;
  }

  .sector-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
    border-color: var(--primary);
  }

  .sector-emoji {
    font-size: 1.5rem;
    margin-bottom: 0.25rem;
  }

  .sector-name {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--foreground);
    margin-bottom: 0.125rem;
  }

  .sector-examples {
    font-size: 0.625rem;
    color: var(--foreground-muted);
    line-height: 1.3;
    display: none;
  }

  @media (min-width: 768px) {
    .sector-examples {
      display: block;
    }
  }
  
  /* Container */
  .container {
    max-width: 1280px;
    margin: 0 auto;
    padding: 2rem 1.5rem 4rem;
  }
  
  /* Sections */
  .section {
    margin-bottom: 3rem;
  }
  
  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1.25rem;
  }
  
  .section-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1.25rem;
    font-weight: 700;
  }
  
  @media (min-width: 640px) {
    .section-title {
      font-size: 1.5rem;
    }
  }
  
  .section-icon {
    font-size: 1.125rem;
  }
  
  .section-subtitle {
    width: 100%;
    font-size: 0.875rem;
    color: var(--foreground-muted);
  }
  
  .section-link {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--primary);
    text-decoration: none;
    transition: color 0.15s;
  }
  
  .section-link:hover {
    color: var(--accent);
  }
  
  /* Posts Grid */
  .posts-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.25rem;
  }
  
  @media (min-width: 640px) {
    .posts-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  
  @media (min-width: 1024px) {
    .posts-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }
  
  .featured-grid {
    grid-template-columns: 1fr;
  }
  
  @media (min-width: 640px) {
    .featured-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  
  @media (min-width: 1024px) {
    .featured-grid {
      grid-template-columns: repeat(3, 1fr);
    }
    
    .featured-grid .featured {
      grid-column: span 2;
      grid-row: span 2;
    }
    
    .featured-grid .featured .post-image {
      aspect-ratio: 16/10;
    }
    
    .featured-grid .featured .post-title {
      font-size: 1.375rem;
    }
  }
  
  .post-card {
    display: flex;
    flex-direction: column;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 0.875rem;
    overflow: hidden;
    text-decoration: none;
    transition: all 0.2s;
  }
  
  .post-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
    border-color: var(--primary);
  }
  
  .post-image {
    aspect-ratio: 16/9;
    overflow: hidden;
    background: var(--muted);
  }
  
  .post-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s;
  }
  
  .post-card:hover .post-image img {
    transform: scale(1.05);
  }
  
  .post-content {
    padding: 1.125rem;
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  
  .post-cluster {
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    font-size: 0.6875rem;
    font-weight: 600;
    color: var(--primary);
    text-transform: uppercase;
    letter-spacing: 0.02em;
    margin-bottom: 0.5rem;
  }
  
  .post-title {
    font-size: 1rem;
    font-weight: 700;
    color: var(--foreground);
    margin-bottom: 0.375rem;
    line-height: 1.35;
  }
  
  .post-excerpt {
    font-size: 0.8125rem;
    color: var(--foreground-muted);
    line-height: 1.5;
    flex: 1;
    margin-bottom: 0.625rem;
  }
  
  .post-meta {
    display: flex;
    align-items: center;
    gap: 0.875rem;
  }
  
  .post-date {
    font-size: 0.75rem;
    color: var(--muted-foreground);
  }
  
  .post-reading {
    display: inline-flex;
    align-items: center;
    gap: 0.2rem;
    font-size: 0.75rem;
    color: var(--muted-foreground);
  }
  
  /* Clusters Grid */
  .clusters-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.875rem;
  }
  
  @media (min-width: 640px) {
    .clusters-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }
  
  @media (min-width: 1024px) {
    .clusters-grid {
      grid-template-columns: repeat(4, 1fr);
    }
  }
  
  @media (min-width: 1280px) {
    .clusters-grid {
      grid-template-columns: repeat(6, 1fr);
    }
  }
  
  .cluster-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1.25rem 0.75rem;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 0.875rem;
    text-decoration: none;
    text-align: center;
    transition: all 0.2s;
  }
  
  .cluster-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
    border-color: var(--primary);
    background: var(--gradient-hero);
  }
  
  .cluster-emoji {
    font-size: 1.75rem;
    margin-bottom: 0.375rem;
  }
  
  .cluster-name {
    font-size: 0.8125rem;
    font-weight: 600;
    color: var(--foreground);
    margin-bottom: 0.125rem;
  }
  
  .cluster-count {
    font-size: 0.6875rem;
    color: var(--foreground-muted);
  }
  
  /* CTA Section */
  .cta-section {
    margin-top: 3rem;
    margin-bottom: 0;
  }
  
  .cta-card {
    background: var(--gradient-primary);
    padding: 2.5rem 1.5rem;
    border-radius: 1.25rem;
    text-align: center;
    box-shadow: var(--shadow-glow);
  }
  
  @media (min-width: 640px) {
    .cta-card {
      padding: 3rem 2rem;
    }
  }
  
  .cta-icon {
    font-size: 2.5rem;
    margin-bottom: 0.75rem;
  }
  
  .cta-card h2 {
    font-size: 1.5rem;
    font-weight: 700;
    color: white;
    margin-bottom: 0.625rem;
  }
  
  @media (min-width: 640px) {
    .cta-card h2 {
      font-size: 1.75rem;
    }
  }
  
  .cta-card p {
    color: rgba(255, 255, 255, 0.9);
    max-width: 550px;
    margin: 0 auto 1.25rem;
    line-height: 1.5;
    font-size: 0.9375rem;
  }
  
  .cta-card .btn-primary {
    background: white;
    color: var(--primary);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
  }
  
  .cta-card .btn-primary:hover {
    color: var(--primary);
    box-shadow: 0 6px 24px rgba(0, 0, 0, 0.3);
  }
</style>
